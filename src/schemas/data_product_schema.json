{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Data Product Specification Schema",
  "description": "Schema for validating Data Product specifications generated by the Agentic Data Product Builder",
  "type": "object",
  "required": ["metadata", "data_model", "transformations"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["name", "version", "description"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Data Product name (snake_case)",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "version": {
          "type": "string",
          "description": "Semantic version (major.minor.patch)",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the Data Product"
        },
        "owner": {
          "type": "string",
          "description": "Team or individual responsible for this Data Product"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation"
        },
        "tags": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Tags for categorization and search"
        }
      }
    },
    "business_context": {
      "type": "object",
      "description": "Business context and requirements",
      "properties": {
        "use_case": {
          "type": "string",
          "description": "Use case identifier (A1, A2, B3, C2, etc.)"
        },
        "business_metrics": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of business metrics this Data Product provides"
        },
        "dimensions": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Dimensions for grouping/aggregation"
        },
        "temporal_granularity": {
          "type": "string",
          "enum": ["hourly", "daily", "weekly", "monthly", "yearly", "snapshot"],
          "description": "Time granularity of the data"
        },
        "stakeholders": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of stakeholders or consumers"
        }
      }
    },
    "data_model": {
      "type": "object",
      "required": ["target_table", "grain", "schema"],
      "properties": {
        "target_table": {
          "type": "string",
          "description": "Target table name (e.g., gold.daily_sales_analytics)",
          "pattern": "^[a-z]+\\.[a-z][a-z0-9_]*$"
        },
        "grain": {
          "type": "string",
          "description": "Data granularity description (e.g., 'Daily, by region and category')"
        },
        "schema": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["name", "type"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Column name"
              },
              "type": {
                "type": "string",
                "description": "Data type (e.g., VARCHAR, INTEGER, DECIMAL(18,2), DATE, TIMESTAMP)"
              },
              "nullable": {
                "type": "boolean",
                "default": true,
                "description": "Whether the column can contain NULL values"
              },
              "primary_key": {
                "type": "boolean",
                "default": false,
                "description": "Whether this column is part of the primary key"
              },
              "description": {
                "type": "string",
                "description": "Column description"
              },
              "default_value": {
                "description": "Default value for the column"
              }
            }
          }
        },
        "primary_keys": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of column names that form the primary key"
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["unique", "check", "foreign_key", "not_null"]
              },
              "columns": {
                "type": "array",
                "items": {"type": "string"}
              },
              "condition": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "source_datasets": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Source dataset name (e.g., bronze.orders)"
          },
          "columns": {
            "type": "array",
            "items": {"type": "string"},
            "description": "List of columns used from this dataset"
          },
          "alias": {
            "type": "string",
            "description": "Table alias used in transformations"
          },
          "join_type": {
            "type": "string",
            "enum": ["inner", "left", "right", "full"],
            "description": "Join type if this dataset is joined"
          },
          "join_condition": {
            "type": "string",
            "description": "Join condition (e.g., 'orders.customer_id = customers.customer_id')"
          }
        }
      }
    },
    "transformations": {
      "type": "object",
      "required": ["language", "code"],
      "properties": {
        "language": {
          "type": "string",
          "enum": ["SQL", "PySpark", "Python"],
          "description": "Transformation language"
        },
        "code": {
          "type": "string",
          "description": "Transformation code"
        },
        "parameters": {
          "type": "object",
          "description": "Parameters or variables used in the transformation"
        },
        "dependencies": {
          "type": "array",
          "items": {"type": "string"},
          "description": "External dependencies or libraries required"
        }
      }
    },
    "quality_rules": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["rule", "severity"],
        "properties": {
          "rule": {
            "type": "string",
            "description": "Quality rule expression (e.g., 'total_revenue > 0')"
          },
          "rule_type": {
            "type": "string",
            "enum": ["completeness", "uniqueness", "validity", "consistency", "accuracy", "timeliness"],
            "description": "Type of quality rule"
          },
          "severity": {
            "type": "string",
            "enum": ["error", "warning", "info"],
            "description": "Severity level if rule fails"
          },
          "threshold": {
            "type": "number",
            "description": "Threshold value (e.g., 0.95 for 95% completeness)"
          },
          "column": {
            "type": "string",
            "description": "Column name this rule applies to"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of the rule"
          }
        }
      }
    },
    "sla": {
      "type": "object",
      "description": "Service Level Agreement requirements",
      "properties": {
        "freshness": {
          "type": "string",
          "description": "Expected data freshness (e.g., 'Daily at 6:00 AM UTC')"
        },
        "latency": {
          "type": "string",
          "description": "Maximum acceptable latency (e.g., '< 30 minutes')"
        },
        "completeness": {
          "type": "string",
          "description": "Required completeness threshold (e.g., '> 99%')"
        },
        "availability": {
          "type": "string",
          "description": "Availability requirement (e.g., '99.9% uptime')"
        }
      }
    },
    "lineage": {
      "type": "object",
      "description": "Data lineage information",
      "properties": {
        "source_datasets": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of source dataset names"
        },
        "transformations_applied": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of transformations applied"
        },
        "dependencies": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Dependencies on other Data Products"
        }
      }
    },
    "documentation": {
      "type": "object",
      "properties": {
        "usage_examples": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Example queries or use cases"
        },
        "known_limitations": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Known limitations or caveats"
        },
        "change_log": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "version": {"type": "string"},
              "date": {"type": "string"},
              "changes": {"type": "string"}
            }
          }
        }
      }
    }
  }
}

